<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.7"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Kalashnikov DB: rec/recovery.c File Reference</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Kalashnikov DB 0.9.2</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_47c25c331c075fe16f320299349474de.html">rec</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">recovery.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;recovery.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for recovery.c:</div>
<div class="dyncontent">
<div class="center"><img src="recovery_8c__incl.png" border="0" usemap="#rec_2recovery_8c" alt=""/></div>
<map name="rec_2recovery_8c" id="rec_2recovery_8c">
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0764228149712593c8af8241538a3ff7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recovery_8c.html#a0764228149712593c8af8241538a3ff7">AK_recover_archive_log</a> (char *fileName)</td></tr>
<tr class="memdesc:a0764228149712593c8af8241538a3ff7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads binary file where last commands were saved, and executes them.  <a href="#a0764228149712593c8af8241538a3ff7">More...</a><br /></td></tr>
<tr class="separator:a0764228149712593c8af8241538a3ff7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a007675f089d3aadc7e1dec6a5421bfd4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recovery_8c.html#a007675f089d3aadc7e1dec6a5421bfd4">AK_recovery_insert_row</a> (char *table, char **attributes)</td></tr>
<tr class="memdesc:a007675f089d3aadc7e1dec6a5421bfd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inserts a new row in table with attributes.  <a href="#a007675f089d3aadc7e1dec6a5421bfd4">More...</a><br /></td></tr>
<tr class="separator:a007675f089d3aadc7e1dec6a5421bfd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94c27377e1fb404252b803979db877bc"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recovery_8c.html#a94c27377e1fb404252b803979db877bc">AK_recovery_tokenize</a> (char *input, char *delimiter, int valuesOrNot)</td></tr>
<tr class="memdesc:a94c27377e1fb404252b803979db877bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tokenizes the input with the given delimiter and puts them in an double pointer structure (so we can execute an insert)  <a href="#a94c27377e1fb404252b803979db877bc">More...</a><br /></td></tr>
<tr class="separator:a94c27377e1fb404252b803979db877bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaab30d878f086d3f949315e7a84c6b4f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recovery_8c.html#aaab30d878f086d3f949315e7a84c6b4f">AK_recover_operation</a> (int sig)</td></tr>
<tr class="memdesc:aaab30d878f086d3f949315e7a84c6b4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that recovers and executes failed commands.  <a href="#aaab30d878f086d3f949315e7a84c6b4f">More...</a><br /></td></tr>
<tr class="separator:aaab30d878f086d3f949315e7a84c6b4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8edc2b153314177eb5ab3d3851d8ea22"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recovery_8c.html#a8edc2b153314177eb5ab3d3851d8ea22">AK_recovery_test</a> ()</td></tr>
<tr class="memdesc:a8edc2b153314177eb5ab3d3851d8ea22"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for recovery testing.  <a href="#a8edc2b153314177eb5ab3d3851d8ea22">More...</a><br /></td></tr>
<tr class="separator:a8edc2b153314177eb5ab3d3851d8ea22"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae9a3d74aeca021c84cae55b9ff943378"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="recovery_8c.html#ae9a3d74aeca021c84cae55b9ff943378">grandfailure</a> = 0</td></tr>
<tr class="separator:ae9a3d74aeca021c84cae55b9ff943378"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides recovery functions. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0764228149712593c8af8241538a3ff7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AK_recover_archive_log </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fileName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads binary file where last commands were saved, and executes them. </p>
<p>Function opens the recovery binary file and executes all commands that were saved inside the redo_log structure </p><dl class="section author"><dt>Author</dt><dd>Dražen Bandić, update by Tomislav Turek </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fileName</td><td>- name of the archive log </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>no value </dd></dl>

</div>
</div>
<a class="anchor" id="aaab30d878f086d3f949315e7a84c6b4f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AK_recover_operation </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that recovers and executes failed commands. </p>
<p>Function is called when SIGINT signal is sent to the system. All commands that are written to rec.bin file are recovered to the designated structure and then executed. </p><dl class="section author"><dt>Author</dt><dd>Tomislav Turek </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sig</td><td>required integer parameter for SIGINT handler functions </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a007675f089d3aadc7e1dec6a5421bfd4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AK_recovery_insert_row </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>attributes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inserts a new row in table with attributes. </p>
<p>Function is given the table name with desired data that should be inserted inside. By using the table name, function retrieves table attributes names and their types which uses afterwards for insert_data_test function to insert data to designated table. </p><dl class="section author"><dt>Author</dt><dd>Dražen Bandić, updated by Tomislav Turek </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">table</td><td>- table name to insert to </td></tr>
    <tr><td class="paramname">attributes</td><td>- attribute to insert </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>no value </dd></dl>

</div>
</div>
<a class="anchor" id="a8edc2b153314177eb5ab3d3851d8ea22"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AK_recovery_test </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for recovery testing. </p>
<p>Function does nothing while waiting a SIGINT signal (signal represents // doxygen @ for full description ??? system failure). Upon retrieving the signal it calls function AK_recover_operation which starts the recovery by building commands. To comply with the designated structure <a class="el" href="structAK__command__recovery__struct.html" title="recovery structure used to recover commands from binary file ">AK_command_recovery_struct</a> // {link} to struct ??? it writes dummy commands to the file log.log </p><dl class="section author"><dt>Author</dt><dd>Tomislav Turek </dd></dl>

</div>
</div>
<a class="anchor" id="a94c27377e1fb404252b803979db877bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** AK_recovery_tokenize </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>delimiter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>valuesOrNot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tokenizes the input with the given delimiter and puts them in an double pointer structure (so we can execute an insert) </p>
<dl class="section author"><dt>Author</dt><dd>Dražen Bandić </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">input</td><td>- input to tokenize </td></tr>
    <tr><td class="paramname">delimiter</td><td>- delimiter </td></tr>
    <tr><td class="paramname">valuesOrNot</td><td>- 1 if the input are values, 0 otherwise </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>new double pointer structure with tokens </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ae9a3d74aeca021c84cae55b9ff943378"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short grandfailure = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>this variable flags if system failed </p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
